<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><title>Shovel | @b9g/filesystem</title><style>.css-xlwoin{position:fixed;top:0;left:0;right:0;height:50px;background-color:var(--bg-color);border-bottom:1px solid var(--text-color);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 1rem;z-index:100;}.css-yq49om{font-size:1.5rem;font-weight:bold;color:var(--highlight-color);-webkit-text-decoration:none;text-decoration:none;}.css-1nfzlxo{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:1.5rem;margin-left:auto;}.css-1nfzlxo a{color:var(--text-color);-webkit-text-decoration:none;text-decoration:none;}.css-1nfzlxo a:hover{color:var(--highlight-color);}.css-1nfzlxo a[aria-current=&quot;page&quot;]{color:var(--highlight-color);}.css-p83kyz{background-color:var(--bg-color);margin-top:50px;padding:2rem 0.4rem;color:var(--text-color);border-right:1px solid currentcolor;border-bottom:1px solid currentcolor;}@media screen and (min-width: 800px){.css-p83kyz{position:fixed;top:50px;bottom:0;overflow-x:hidden;overflow-y:auto;width:15rem;margin:0;padding:2rem 1rem;text-align:right;}}@media screen and (min-width: 1100px){.css-p83kyz{padding:3rem 2rem;width:20rem;}}.css-p83kyz &gt;:first-child{margin-top:0;}.css-l91ppu{font-size:0.85rem;color:var(--highlight-color);margin:1.5rem 0 0.5rem;text-transform:uppercase;letter-spacing:0.05em;font-weight:bold;}.css-l91ppu:first-of-type{margin-top:0;}.css-1jwyx8k{display:block;margin:0.5rem 0;-webkit-text-decoration:none;text-decoration:none;color:var(--text-color);}.css-1jwyx8k:hover{color:var(--highlight-color);}.css-1jwyx8k[aria-current=&quot;page&quot;]{color:var(--highlight-color);font-weight:bold;}.css-ep9szm{color:var(--highlight-color);margin-top:0;}.css-v6xkb5{margin:0 auto;padding:2rem 0.4rem;}@media screen and (min-width: 800px){.css-v6xkb5{margin-left:240px;padding:2rem 1rem;margin-top:50px;}}@media screen and (min-width: 1100px){.css-v6xkb5{margin-left:20rem;padding:3rem 2rem;}}.css-v6xkb5 &gt;:first-child{margin-top:0;}.css-v6xkb5 p{max-width:800px;}.css-v6xkb5 pre{background:var(--code-bg);padding:1rem;border-radius:4px;overflow-x:auto;}.css-v6xkb5 code{font-family:&quot;SF Mono&quot;,Menlo,Monaco,&quot;Courier New&quot;,monospace;font-size:0.9em;}.css-v6xkb5 code.inline{background:var(--code-bg);padding:0.2em 0.4em;border-radius:3px;}</style><link rel="stylesheet" type="text/css" href="/static/client-d338c3cf2d1d9d72.css"><meta name="description" content=""><meta property="og:title" content="Shovel | @b9g/filesystem"><meta property="og:description" content=""><meta property="og:type" content="website"><meta property="og:site_name" content="Shovel"></head><body><div id="navbar-root"><nav class="css-xlwoin"><a href="/" class="css-yq49om">Shovel</a><div class="css-1nfzlxo"><a href="/guides/getting-started">Guides</a><a href="/api" aria-current="page">API</a><a href="/blog">Blog</a><a href="https://github.com/bikeshaving/shovel">GitHub</a></div></nav></div><div id="sidebar" class="css-p83kyz"><h2 class="css-ep9szm">API</h2><div class="css-l91ppu">shovel</div><a href="/api/cli" class="css-1jwyx8k">CLI</a><a href="/api/serviceworker" class="css-1jwyx8k">ServiceWorker</a><a href="/api/shovel-json" class="css-1jwyx8k">shovel.json</a><div class="css-l91ppu">@b9g/router</div><a href="/api/middleware" class="css-1jwyx8k">@b9g/router/middleware</a><a href="/api/router" class="css-1jwyx8k">Routing</a><div class="css-l91ppu">@b9g/assets</div><a href="/api/assets" class="css-1jwyx8k">@b9g/assets</a><div class="css-l91ppu">@b9g/async-context</div><a href="/api/async-context" class="css-1jwyx8k">@b9g/async-context</a><div class="css-l91ppu">@b9g/cache</div><a href="/api/cache" class="css-1jwyx8k">Caches</a><div class="css-l91ppu">@b9g/cookies</div><a href="/api/cookies" class="css-1jwyx8k">@b9g/cookies</a><div class="css-l91ppu">@b9g/filesystem</div><a href="/api/filesystem" class="css-1jwyx8k" aria-current="page">@b9g/filesystem</a><div class="css-l91ppu">@b9g/http-errors</div><a href="/api/http-errors" class="css-1jwyx8k">@b9g/http-errors</a><div class="css-l91ppu">@b9g/zen</div><a href="/api/zen" class="css-1jwyx8k">@b9g/zen</a><div class="css-l91ppu">@logtape/logtape</div><a href="/api/logging" class="css-1jwyx8k">@logtape/logtape</a></div><main class="css-v6xkb5"><h1 id="b9gfilesystem">@b9g/filesystem</h1>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/File_System_API">File System Access API</a> implementation for servers.</p>
<hr>
<h2 id="directorystorage">DirectoryStorage</h2>
<p>Global <code>self.directories</code> provides access to configured directories.</p>
<h3 id="openname-string-promisefilesystemdirectoryhandle">open(name: string): Promise&lt;FileSystemDirectoryHandle&gt;</h3>
<p>Opens a named directory.</p>
<pre><code class="language-typescript"><span class="token keyword">const</span> uploads <span class="token operator">=</span> <span class="token keyword">await</span> self<span class="token punctuation">.</span>directories<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"uploads"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<hr>
<h2 id="filesystemdirectoryhandle">FileSystemDirectoryHandle</h2>
<p>Implements <a href="https://developer.mozilla.org/en-US/docs/Web/API/FileSystemDirectoryHandle">FileSystemDirectoryHandle</a>.</p>
<h3 id="properties">Properties</h3>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>kind</code></td>
<td><code>&quot;directory&quot;</code></td>
<td>Always <code>&quot;directory&quot;</code></td>
</tr>
<tr>
<td><code>name</code></td>
<td><code>string</code></td>
<td>Directory name</td>
</tr>
</tbody></table>
<h3 id="getfilehandlename-string-options--create-boolean--promisefilesystemfilehandle">getFileHandle(name: string, options?: { create?: boolean }): Promise&lt;FileSystemFileHandle&gt;</h3>
<p>Gets a file handle within the directory.</p>
<pre><code class="language-typescript"><span class="token keyword">const</span> file <span class="token operator">=</span> <span class="token keyword">await</span> dir<span class="token punctuation">.</span><span class="token function">getFileHandle</span><span class="token punctuation">(</span><span class="token string">"config.json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> file <span class="token operator">=</span> <span class="token keyword">await</span> dir<span class="token punctuation">.</span><span class="token function">getFileHandle</span><span class="token punctuation">(</span><span class="token string">"new.txt"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> create<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="getdirectoryhandlename-string-options--create-boolean--promisefilesystemdirectoryhandle">getDirectoryHandle(name: string, options?: { create?: boolean }): Promise&lt;FileSystemDirectoryHandle&gt;</h3>
<p>Gets a subdirectory handle.</p>
<pre><code class="language-typescript"><span class="token keyword">const</span> subdir <span class="token operator">=</span> <span class="token keyword">await</span> dir<span class="token punctuation">.</span><span class="token function">getDirectoryHandle</span><span class="token punctuation">(</span><span class="token string">"images"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> subdir <span class="token operator">=</span> <span class="token keyword">await</span> dir<span class="token punctuation">.</span><span class="token function">getDirectoryHandle</span><span class="token punctuation">(</span><span class="token string">"cache"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> create<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="removeentryname-string-options--recursive-boolean--promisevoid">removeEntry(name: string, options?: { recursive?: boolean }): Promise&lt;void&gt;</h3>
<p>Removes a file or directory.</p>
<pre><code class="language-typescript"><span class="token keyword">await</span> dir<span class="token punctuation">.</span><span class="token function">removeEntry</span><span class="token punctuation">(</span><span class="token string">"old.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> dir<span class="token punctuation">.</span><span class="token function">removeEntry</span><span class="token punctuation">(</span><span class="token string">"old-folder"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> recursive<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="entries-asynciterableiteratorstring-filesystemhandle">entries(): AsyncIterableIterator&lt;[string, FileSystemHandle]&gt;</h3>
<p>Iterates over directory contents.</p>
<pre><code class="language-typescript"><span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> handle<span class="token punctuation">]</span> <span class="token keyword">of</span> dir<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> handle<span class="token punctuation">.</span>kind<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="keys-asynciterableiteratorstring">keys(): AsyncIterableIterator&lt;string&gt;</h3>
<p>Iterates over entry names.</p>
<pre><code class="language-typescript"><span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> name <span class="token keyword">of</span> dir<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="values-asynciterableiteratorfilesystemhandle">values(): AsyncIterableIterator&lt;FileSystemHandle&gt;</h3>
<p>Iterates over entry handles.</p>
<pre><code class="language-typescript"><span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> handle <span class="token keyword">of</span> dir<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>handle<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="resolvepossibledescendant-filesystemhandle-promisestring--null">resolve(possibleDescendant: FileSystemHandle): Promise&lt;string[] | null&gt;</h3>
<p>Returns the path from this directory to a descendant.</p>
<pre><code class="language-typescript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token keyword">await</span> dir<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>subdir<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ["a", "b", "c"]</span>
</code></pre>
<h3 id="issameentryother-filesystemhandle-promiseboolean">isSameEntry(other: FileSystemHandle): Promise&lt;boolean&gt;</h3>
<p>Checks if two handles reference the same entry.</p>
<pre><code class="language-typescript"><span class="token keyword">await</span> file1<span class="token punctuation">.</span><span class="token function">isSameEntry</span><span class="token punctuation">(</span>file2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre>
<hr>
<h2 id="filesystemfilehandle">FileSystemFileHandle</h2>
<p>Implements <a href="https://developer.mozilla.org/en-US/docs/Web/API/FileSystemFileHandle">FileSystemFileHandle</a>.</p>
<h3 id="properties-1">Properties</h3>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>kind</code></td>
<td><code>&quot;file&quot;</code></td>
<td>Always <code>&quot;file&quot;</code></td>
</tr>
<tr>
<td><code>name</code></td>
<td><code>string</code></td>
<td>File name</td>
</tr>
</tbody></table>
<h3 id="getfile-promisefile">getFile(): Promise&lt;File&gt;</h3>
<p>Returns the file as a <a href="https://developer.mozilla.org/en-US/docs/Web/API/File">File</a> object.</p>
<pre><code class="language-typescript"><span class="token keyword">const</span> file <span class="token operator">=</span> <span class="token keyword">await</span> fileHandle<span class="token punctuation">.</span><span class="token function">getFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token keyword">await</span> file<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="createwritableoptions--keepexistingdata-boolean--promisefilesystemwritablefilestream">createWritable(options?: { keepExistingData?: boolean }): Promise&lt;FileSystemWritableFileStream&gt;</h3>
<p>Creates a writable stream for writing to the file.</p>
<pre><code class="language-typescript"><span class="token keyword">const</span> writable <span class="token operator">=</span> <span class="token keyword">await</span> fileHandle<span class="token punctuation">.</span><span class="token function">createWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> writable<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"Hello, World!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> writable<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="createsyncaccesshandle-promisefilesystemsyncaccesshandle">createSyncAccessHandle(): Promise&lt;FileSystemSyncAccessHandle&gt;</h3>
<p>Creates a synchronous access handle (workers only).</p>
<pre><code class="language-typescript"><span class="token keyword">const</span> handle <span class="token operator">=</span> <span class="token keyword">await</span> fileHandle<span class="token punctuation">.</span><span class="token function">createSyncAccessHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bytesRead <span class="token operator">=</span> handle<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token punctuation">{</span> at<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
handle<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<hr>
<h2 id="filesystemwritablefilestream">FileSystemWritableFileStream</h2>
<h3 id="writedata-string--buffersource--blob--writeparams-promisevoid">write(data: string | BufferSource | Blob | WriteParams): Promise&lt;void&gt;</h3>
<p>Writes data to the file.</p>
<h3 id="seekposition-number-promisevoid">seek(position: number): Promise&lt;void&gt;</h3>
<p>Moves the write position.</p>
<h3 id="truncatesize-number-promisevoid">truncate(size: number): Promise&lt;void&gt;</h3>
<p>Resizes the file.</p>
<h3 id="close-promisevoid">close(): Promise&lt;void&gt;</h3>
<p>Commits changes and closes the stream.</p>
<hr>
<h2 id="configuration">Configuration</h2>
<p>Configure in <code>shovel.json</code>:</p>
<pre><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"directories"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"uploads"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"@b9g/filesystem/node-fs"</span><span class="token punctuation">,</span>
      <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"./uploads"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="fields">Fields</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>module</code></td>
<td><code>string</code></td>
<td>Module path</td>
</tr>
<tr>
<td><code>export</code></td>
<td><code>string</code></td>
<td>Named export (default: <code>&quot;default&quot;</code>)</td>
</tr>
<tr>
<td><code>path</code></td>
<td><code>string</code></td>
<td>Filesystem path</td>
</tr>
<tr>
<td><code>binding</code></td>
<td><code>string</code></td>
<td>Platform binding (Cloudflare)</td>
</tr>
<tr>
<td><code>bucket</code></td>
<td><code>string</code></td>
<td>S3 bucket name</td>
</tr>
<tr>
<td><code>region</code></td>
<td><code>string</code></td>
<td>AWS region</td>
</tr>
<tr>
<td><code>endpoint</code></td>
<td><code>string</code></td>
<td>S3-compatible endpoint</td>
</tr>
</tbody></table>
<h3 id="built-in-directories">Built-in Directories</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Path</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>server</code></td>
<td><code>[outdir]/server</code></td>
<td>Server-side bundled code</td>
</tr>
<tr>
<td><code>public</code></td>
<td><code>[outdir]/public</code></td>
<td>Static assets</td>
</tr>
<tr>
<td><code>tmp</code></td>
<td><code>[tmpdir]</code></td>
<td>Temporary files</td>
</tr>
</tbody></table>
<hr>
<h2 id="implementations">Implementations</h2>
<table>
<thead>
<tr>
<th>Module</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>@b9g/filesystem/node-fs</code></td>
<td>Node.js native fs</td>
</tr>
<tr>
<td><code>@b9g/filesystem/bun</code></td>
<td>Bun native file APIs</td>
</tr>
<tr>
<td><code>@b9g/filesystem/memory</code></td>
<td>In-memory (lost on restart)</td>
</tr>
<tr>
<td><code>@b9g/filesystem-s3</code></td>
<td>Amazon S3 / S3-compatible</td>
</tr>
</tbody></table>
<hr>
<h2 id="see-also">See Also</h2>
<ul>
<li><a href="/api/shovel-json">shovel.json</a> - Configuration reference</li>
<li><a href="/api/cache">Cache</a> - Request/Response caching</li>
<li><a href="/api/zen">ZenDB</a> - SQL database storage</li>
</ul>
</main></body></html>