<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><title>Shovel | Introducing Shovel</title><style>.css-xlwoin{position:fixed;top:0;left:0;right:0;height:50px;background-color:var(--bg-color);border-bottom:1px solid var(--text-color);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 1rem;z-index:100;}.css-yq49om{font-size:1.5rem;font-weight:bold;color:var(--highlight-color);-webkit-text-decoration:none;text-decoration:none;}.css-1nfzlxo{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:1.5rem;margin-left:auto;}.css-1nfzlxo a{color:var(--text-color);-webkit-text-decoration:none;text-decoration:none;}.css-1nfzlxo a:hover{color:var(--highlight-color);}.css-1nfzlxo a[aria-current=&quot;page&quot;]{color:var(--highlight-color);}.css-1fkcave{max-width:800px;margin:0 auto;padding:2rem 1rem;}@media screen and (min-width: 800px){.css-1fkcave{padding:3rem 2rem;margin-top:50px;}}.css-1fkcave p{line-height:1.7;}.css-1fkcave pre{background:var(--code-bg);padding:1rem;border-radius:4px;overflow-x:auto;}.css-1fkcave code{font-family:&quot;SF Mono&quot;,Menlo,Monaco,&quot;Courier New&quot;,monospace;font-size:0.9em;}.css-1fkcave code.inline{background:var(--code-bg);padding:0.2em 0.4em;border-radius:3px;}.css-1174wc2{color:var(--text-muted);margin-bottom:2rem;font-size:0.95rem;}.css-4y579w{display:inline-block;margin-bottom:2rem;color:var(--highlight-color);-webkit-text-decoration:none;text-decoration:none;}.css-4y579w:hover{-webkit-text-decoration:underline;text-decoration:underline;}</style><link rel="stylesheet" type="text/css" href="/static/client-d338c3cf2d1d9d72.css"><meta name="description" content="The story behind Shovel.js, a framework which asks the question “What if your server was just a service worker?”"><meta property="og:title" content="Shovel | Introducing Shovel"><meta property="og:description" content="The story behind Shovel.js, a framework which asks the question “What if your server was just a service worker?”"><meta property="og:type" content="website"><meta property="og:site_name" content="Shovel"></head><body><div id="navbar-root"><nav class="css-xlwoin"><a href="/" class="css-yq49om">Shovel</a><div class="css-1nfzlxo"><a href="/guides/getting-started">Guides</a><a href="/api">API</a><a href="/blog" aria-current="page">Blog</a><a href="https://github.com/bikeshaving/shovel">GitHub</a></div></nav></div><article class="css-1fkcave"><a href="/blog" class="css-4y579w">← Back to Blog</a><h1>Introducing Shovel</h1><p class="css-1174wc2">February 7, 2026 by <a href="https://github.com/brainkim">Brian Kim</a></p><p>Today, I’m happy to announce my first major AI-assisted open source project. And no, it’s not a weird AI village creating tool. Rather, <strong>Shovel.js</strong> is a three-month meditation on the question: “what if your server was just a service worker?” The result is a command-line interface and a set of libraries for developing and deploying Service Workers as web applications. It is both a full-stack server framework replacing tools like Express, Fastify or Hono, and a meta-framework / compiler replacing tools like Vite or Next.js.</p>
<p>The following is a contemporary description of what building a greenfield open source project with AI is like, as well as a quick tour of some of Shovel’s most elegantly designed features.</p>
<h2 id="the-start-of-the-journey">The Start of the Journey</h2>
<p>Work on Shovel.js began in earnest in October 2025, right about when the Remix team announced a reboot of their full stack runtime. Notably, they decided to <a href="https://remix.run/blog/wake-up-remix">migrate away from React.js as their UI framework</a>, opting to <a href="https://github.com/remix-run/remix/tree/main/packages/component">roll their own</a> instead. As the author of <a href="https://crank.js.org">Crank.js</a>, I was disappointed that they didn’t choose to adopt Crank directly, even though it was <a href="https://xcancel.com/ryanflorence/status/1977719354180485197">mentioned as inspiration for the framework they built</a>. Nevertheless, it would have been intensely hypocritical for me to begrudge any developer for choosing to roll their own anything, and it seems like the Remix team is having fun owning the entire stack.</p>
<p>Ultimately though, this signaled to me that I couldn’t wait for someone else to build a full-stack Crank meta-framework: I would have to do it myself. At the time, the Crank documentation website was running on a rudimentary static site generator I had hacked together with ESBuild. Could I expand this into a full-fledged framework? What would it look like? How long would it take? I was eager to see how much more efficiently I could complete this immense, open-ended task with Claude Code by my side.</p>
<h2 id="the-design-philosophy">The Design Philosophy</h2>
<p>The plan for the framework was simple: create a way to run Service Workers anywhere, by implementing all related standards and specifications. I’ve been fascinated by this idea for many years. In my free time, I would look through MDN the same way other people go down Wikipedia rabbit holes, finding hidden gems like <a href="https://developer.mozilla.org/en-US/docs/Web/API/File_System_API">the FileSystem API</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/API/CookieStore">the CookieStore API</a>, and <a href="https://developer.mozilla.org/en-US/docs/Web/API/Cache">the Cache API</a>. These are real, rigorously specified abstractions which are shipped in all major browsers.</p>
<p>Could these battle-tested APIs be repurposed for server runtimes? Most contemporary JavaScript server frameworks seem to be moving in this direction. For instance, almost all server frameworks written today use the fetch standard’s <code>Request</code> and <code>Response</code> classes rather than Node’s idiosyncratic <code>IncomingMessage</code> and <code>OutgoingMessage</code> ones. And there’s been a push to find a <strong>minimal common API</strong> across JavaScript runtimes like Bun, Node and Cloudflare Workers (see <a href="https://wintertc.org/">WinterTC</a>). But I wanted to take things a step further. What if, rather than designing new APIs, we just provided shims and implementations of all the applicable browser standards found on MDN?</p>
<p>I started by asking Claude Code to implement the Service Worker’s <code>Cache</code> abstractions for Bun and Node. It produced a working implementation in a single shot. As it turns out, this type of work is right in Claude’s wheelhouse: I discovered you could just direct Claude to a web specification, and it would write a reasonable implementation.</p>
<p>As of today, we’ve implemented at least six different browser standards and brought them together as a feature-complete constellation of NPM packages, tied together by a CLI which covers both development and deployment workflows. Together, these tools create a cohesive user experience where you can write code that looks like browser service workers but run it on Node, Bun or Cloudflare.</p>
<p>For example, here is a service worker which exposes the cache system as a REST-ful API:</p>
<pre><code class="language-ts">self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"fetch"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ev<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  ev<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span><span class="token function">handleRequest</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Response<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">await</span> self<span class="token punctuation">.</span>caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"kv"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">"GET"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> cached <span class="token operator">=</span> <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> cached <span class="token operator">||</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">"Not Found"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>status<span class="token operator">:</span> <span class="token number">404</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">"PUT"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token keyword">await</span> req<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">"OK"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>status<span class="token operator">:</span> <span class="token number">201</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">"DELETE"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">"OK"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>status<span class="token operator">:</span> <span class="token number">204</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">"Method Not Allowed"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>status<span class="token operator">:</span> <span class="token number">405</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="architectural-flourishes">Architectural Flourishes</h2>
<p>While the plan of shimming all of MDN for servers was straightforward, there were still gaps in what’s necessary for a full-stack framework. Browser service workers don’t implement features like routing, middleware, local filesystems, database adapters, structured logging, or the configuration of all these services. Nor is there anything in browser standards about how static assets should be referenced and served. This would require some careful design thinking from me, the human. The approach I decided to take was to extrapolate rather than invent: if browser service workers look like <em>this</em>, then what would the missing server features look like? Here’s some of what we’ve come up with.</p>
<h3 id="routers-and-middleware">Routers and Middleware</h3>
<p>While the browser has a concept of URL matching with <a href="https://developer.mozilla.org/en-US/docs/Web/API/URLPattern">URLPattern</a>, there is still no unified routing abstraction for executing code based on request and method. Therefore, the package <code>@b9g/router</code> implements a fast router with middleware.</p>
<pre><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>Router<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@b9g/router"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> logger <span class="token operator">=</span> self<span class="token punctuation">.</span>loggers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"app"</span><span class="token punctuation">,</span> <span class="token string">"cache"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">"/kv/:key"</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    logger<span class="token punctuation">.</span>info<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">GET </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">await</span> self<span class="token punctuation">.</span>caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"kv"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> cached <span class="token operator">=</span> <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> cached <span class="token operator">||</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">"Not Found"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>status<span class="token operator">:</span> <span class="token number">404</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    logger<span class="token punctuation">.</span>info<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">PUT </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">await</span> self<span class="token punctuation">.</span>caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"kv"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token keyword">await</span> req<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">"OK"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>status<span class="token operator">:</span> <span class="token number">201</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    logger<span class="token punctuation">.</span>info<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">DELETE </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">await</span> self<span class="token punctuation">.</span>caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"kv"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>status<span class="token operator">:</span> <span class="token number">204</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"fetch"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ev<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  ev<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>This router is both fast and standards-aligned. For instance, it uses <a href="https://github.com/bikeshaving/shovel/tree/main/packages/match-pattern"><code>MatchPattern</code></a>, a URLPattern-compatible class with some fixes for surprising behavior. This class passes 100% of the Web Platform Tests while being significantly faster than native browser implementations. And under the hood, the router compiles routes to a radix tree for O(1) path matching — the same algorithm used by Fastify and other high-performance routers.</p>
<p>Of course, it wouldn’t be a Brian Kim open source project without a creative use of generator functions. The router implements a flexible, Rack-style (last in, first out) middleware system where you can modify requests and responses with functions and generator functions.</p>
<pre><code class="language-ts"><span class="token comment">// Function middleware: return Response to short-circuit, or null/undefined to continue</span>
router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">"/api"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"Authorization"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">"Unauthorized"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>status<span class="token operator">:</span> <span class="token number">401</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  ctx<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">verifyToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Generator middleware: yield to get next response and modify it</span>
router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">timing</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> start <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">yield</span> req<span class="token punctuation">;</span>
  response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"X-Response-Time"</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> response<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// The router package provides built-in middleware as higher-order functions</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>cors<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@b9g/router/middleware"</span><span class="token punctuation">;</span>

<span class="token comment">// Built-in CORS middleware</span>
router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">{</span>origin<span class="token operator">:</span> <span class="token string">"https://example.com"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>The <code>yield</code> operator marks where control passes to the next handler. When that handler returns, execution resumes after the yield with the response. Other frameworks typically use a separate <code>next()</code> function to pass to later middleware, whereas the Shovel router uses control flow to clarify the middleware lifecycle: before <code>yield</code> is the request phase, after <code>yield</code> is the response phase. Using control flow means you can’t have situations where you forget to call <code>next()</code>, or call it outside of an async middleware’s execution window.</p>
<h3 id="curated-globals">Curated Globals</h3>
<p>As we’ve seen, browser Service Workers have a built-in cache abstraction (<code>self.caches</code>), but servers also need access to things like file systems, loggers and databases. While you could import libraries or use Node globals like Node’s <code>fs</code>, we’ve taken the Service Worker storage pattern and expanded it into a curated set of helpful globals.</p>
<p>Not everything earns a spot on <code>self</code>. Each API has to be:</p>
<ul>
<li>Configurable across multiple backends</li>
<li>Rigorous enough to feel like it belongs on MDN</li>
<li>Universal across server and server-less platforms</li>
</ul>
<p>Of course, many globals are direct web standards: the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Cache">Cache API</a> for caching, the <a href="https://developer.mozilla.org/en-US/docs/Web/API/File_System_API">FileSystem API</a> for file storage, and the <a href="https://developer.mozilla.org/en-US/docs/Web/API/CookieStore">CookieStore API</a> for cookie management. Others are carefully chosen libraries that feel like they <em>could</em> be standards: <a href="https://logtape.org/">LogTape</a> for structured logging, or <a href="https://github.com/bikeshaving/ZenDB">ZenDB</a>, a SQL library which brings IndexedDB-style migrations and Zod-based schemas to relational databases. Okay, ZenDB is also written by me, but I do think it exhibits “standard-like” qualities.</p>
<p>Shovel provides an env-driven configuration format <code>shovel.json</code> which ties all of these services together, following the <a href="https://12factor.net/">12-factor app</a> philosophy of separating config from code:</p>
<pre><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"caches"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"pages"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"$MODE === production ? @b9g/cache-redis : @b9g/cache/memory"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"databases"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"main"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"@b9g/zen/bun"</span><span class="token punctuation">,</span>
      <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"$DATABASE_URL"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"directories"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"uploads"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"$MODE === production ? @b9g/filesystem-s3 : @b9g/filesystem"</span><span class="token punctuation">,</span>
      <span class="token property">"bucket"</span><span class="token operator">:</span> <span class="token string">"$S3_BUCKET"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"logging"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"sinks"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"otel"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"@logtape/otel"</span><span class="token punctuation">,</span>
        <span class="token property">"export"</span><span class="token operator">:</span> <span class="token string">"getOpenTelemetrySink"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"loggers"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"app"</span><span class="token punctuation">,</span> <span class="token property">"level"</span><span class="token operator">:</span> <span class="token string">"info"</span><span class="token punctuation">,</span> <span class="token property">"sinks"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"otel"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>With Shovel’s configuration system, your service worker calls <code>self.caches.open(&quot;pages&quot;)</code>, <code>self.directories.open(&quot;public&quot;)</code>, <code>self.databases.get(&quot;main&quot;)</code>, and each of these storages can be configured to work with services like S3, Redis, SQLite, Postgres without modifying the code.</p>
<p>Here’s what a file upload handler might look like using some of the globals we mentioned:</p>
<pre><code class="language-ts"><span class="token keyword">const</span> logger <span class="token operator">=</span> self<span class="token punctuation">.</span>loggers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"app"</span><span class="token punctuation">,</span> <span class="token string">"uploads"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">"/api/uploads"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> db <span class="token operator">=</span> self<span class="token punctuation">.</span>databases<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"main"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> uploads <span class="token operator">=</span> <span class="token keyword">await</span> self<span class="token punctuation">.</span>directories<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"uploads"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> form <span class="token operator">=</span> <span class="token keyword">await</span> req<span class="token punctuation">.</span><span class="token function">formData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> file <span class="token operator">=</span> form<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> File<span class="token punctuation">;</span>

  logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Upload started"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> file<span class="token punctuation">.</span>name<span class="token punctuation">,</span> size<span class="token operator">:</span> file<span class="token punctuation">.</span>size<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Save to filesystem (local in dev, S3 in prod)</span>
  <span class="token keyword">const</span> userDir <span class="token operator">=</span> <span class="token keyword">await</span> uploads<span class="token punctuation">.</span><span class="token function">getDirectoryHandle</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token punctuation">{</span>create<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> handle <span class="token operator">=</span> <span class="token keyword">await</span> userDir<span class="token punctuation">.</span><span class="token function">getFileHandle</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token punctuation">{</span>create<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> writable <span class="token operator">=</span> <span class="token keyword">await</span> handle<span class="token punctuation">.</span><span class="token function">createWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> writable<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> writable<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Record in database</span>
  <span class="token keyword">const</span> record <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>Uploads<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    userId<span class="token operator">:</span> ctx<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
    filename<span class="token operator">:</span> file<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
    size<span class="token operator">:</span> file<span class="token punctuation">.</span>size<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Upload complete"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>id<span class="token operator">:</span> record<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>record<span class="token punctuation">,</span> <span class="token punctuation">{</span>status<span class="token operator">:</span> <span class="token number">201</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="simpler-static-assets">Simpler Static Assets</h3>
<p>I wanted Shovel to be a meta-framework, transpiling and bundling both server and client code with ESBuild. I knew that figuring out how to reference, transform and serve client assets was a key part of the developer experience, but I didn’t yet know what it would look like.</p>
<p>To me it seemed like every major JavaScript build tool — Webpack, Parcel, Vite, Next.js — invented its own frustratingly complex loader system, or required brittle file-based routing to essentially inject asset references into the final HTML response. What I wanted was simpler: pass a local filepath, get back a public URL.</p>
<p>Luckily, another standard, <a href="https://github.com/tc39/proposal-import-attributes">import attributes</a> allowed us to turn local references into public URLs, with the same import syntax you use to read modules:</p>
<pre><code class="language-ts"><span class="token keyword">import</span> favicon <span class="token keyword">from</span> <span class="token string">"./favicon.ico"</span> <span class="token keyword">with</span> <span class="token punctuation">{</span>assetBase<span class="token operator">:</span> <span class="token string">"/"</span><span class="token punctuation">,</span> assetName<span class="token operator">:</span> <span class="token string">"favicon.ico"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">"./styles.css"</span> <span class="token keyword">with</span> <span class="token punctuation">{</span>assetBase<span class="token operator">:</span> <span class="token string">"/static/"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> client <span class="token keyword">from</span> <span class="token string">"./client.ts"</span> <span class="token keyword">with</span> <span class="token punctuation">{</span>assetBase<span class="token operator">:</span> <span class="token string">"/static/"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// favicon = "/favicon.ico" (no hash, well-known path)</span>
<span class="token comment">// styles = "/static/styles-abc123.css"</span>
<span class="token comment">// client = "/static/client-def456.js"</span>

router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;!DOCTYPE html>
    &lt;html>
      &lt;head>
        &lt;link rel="icon" href="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>favicon<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">">
        &lt;link rel="stylesheet" href="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>styles<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">">
      &lt;/head>
      &lt;body>
        &lt;h1>Hello from Shovel&lt;/h1>
        &lt;script src="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>client<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">">&lt;/script>
      &lt;/body>
    &lt;/html>
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span> headers<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">"Content-Type"</span><span class="token operator">:</span> <span class="token string">"text/html"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Using import attributes means no file-based routing, no special bundler plugins, no magical HTML file which gets rewritten with the correct final assets.</p>
<p>Furthermore, while I set out to build a meta-framework for my own UI framework (Crank.js), it turned out that this approach meant that Shovel could be a framework-agnostic server and compiler. The framework passes imports to ESBuild for bundling, hashing, and code splitting, then serves them via middleware backed by <code>self.directories.open(&quot;public&quot;)</code>. Because assets resolve to plain URL strings, Shovel works with any client framework that doesn’t require complex bespoke compilation (<a href="https://htmx.org">HTMX</a>, <a href="https://lit.dev">Lit</a>, <a href="https://alpinejs.dev">Alpine.js</a>). It can even work with vanilla JavaScript.</p>
<h3 id="truly-universal-rendering">Truly Universal Rendering</h3>
<p>JavaScript frameworks love using three-letter acronyms to describe rendering strategies. SSR (server-side rendering) is when the server creates HTML during the request/response lifecycle, SSG (static-site generation) is when this HTML generation is moved to a build step, SPA (single-page application) is when the HTML generation is moved to the client. Each of these modes describes when and where HTML gets rendered, and frameworks might have wildly different workflows for each mode.</p>
<p>With Shovel, most code is just written in the fetch handler, regardless of rendering mode. The difference between the modes is just timing.</p>
<p>For instance, I’m particularly fond of how static-site generation is implemented with Shovel. You can use the service worker’s <code>install</code> event to self-fetch HTML pages, using the same pattern browser service workers use to pre-cache pages:</p>
<pre><code class="language-ts">self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"install"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ev<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  ev<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span><span class="token function">generateStaticSite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">generateStaticSite</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> publicDir <span class="token operator">=</span> <span class="token keyword">await</span> self<span class="token punctuation">.</span>directories<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"public"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> route <span class="token keyword">of</span> <span class="token punctuation">[</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"/about"</span><span class="token punctuation">,</span> <span class="token string">"/blog"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// hits your own router</span>
    <span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// /about -> about/index.html</span>
    <span class="token keyword">const</span> path <span class="token operator">=</span> route <span class="token operator">===</span> <span class="token string">"/"</span> <span class="token operator">?</span> <span class="token string">"index.html"</span> <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>route<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/index.html</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> file <span class="token operator">=</span> <span class="token keyword">await</span> publicDir<span class="token punctuation">.</span><span class="token function">getFileHandle</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token punctuation">{</span>create<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> writable <span class="token operator">=</span> <span class="token keyword">await</span> file<span class="token punctuation">.</span><span class="token function">createWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> writable<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> writable<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>With this utility function and <code>install</code> handler, we can add SSG to any website without having to modify fetch handlers. And because you can write to the same <code>FileSystem</code> directory where assets are written (public), client-side JavaScript and other static references just work.</p>
<h2 id="early-adopters-welcome">Early Adopters Welcome</h2>
<p>Three months ago, I didn’t know if AI could help me build a server framework, or if the result would be any good. In the end, Shovel turned out to be the framework I’ve always dreamed of. It’s obsessively standards-based, carefully designed, and definitely not a vibe-coded throwaway.</p>
<p>Shovel was built primarily with Claude Code, and in the development process I bore witness to numerous superhuman feats by it along the way: when the router was slow, Claude added radix trees; when native <code>URLPattern</code> was slow, Claude implemented a <code>RegExp</code>-based alternative passing 100% of web platform tests; when I wanted a DSL for <code>shovel.json</code>, Claude one-shot it after careful planning; when I got frustrated with DrizzleORM, we designed <a href="https://github.com/bikeshaving/ZenDB">ZenDB</a> over the holidays. Open source software development is still hard work, but it’s new work, where I ideate and plan with Claude, watch it grant my wishes, and then verify the code wasn’t written in a dumb way.</p>
<p>Therefore, I’m happy to announce that Shovel.js is ready for early adopters. There are certainly bugs, and there will be breaking changes, but I’m using it for everything now. And if you’re building with AI, you should know that Shovel works great with LLMs because it targets one of their greatest strengths: high-fidelity knowledge of web standards. Shovel provides the predictable, standards-based foundation that lets agents do their best work. And if you encounter any behavior which is inconsistent with standards, please open an issue because that’s a bug.</p>
<p>The roadmap is ambitious: sessions, authentication, websockets, cron jobs, email; ultimately, I want Shovel to be maximally batteries included, complete with an admin interface like Django. To this extent, if you know of any interesting web standards, or libraries that are so well-specified that they <em>should</em> be web standards, please let me know. I’ve already gotten started on implementing <code>IndexedDB</code> and <code>BroadcastChannel</code> across platforms.</p>
<p>If you’ve read this far, I hope I&#39;ve convinced you to try Shovel. You can get started right now:</p>
<pre><code class="language-bash"><span class="token function">npm</span> create shovel my-app
</code></pre>
<p>You can also <a href="/guides/getting-started">read the docs</a>, or follow <a href="https://github.com/bikeshaving/shovel">development on GitHub</a>. Remember, if you know how to write a Service Worker, you already know how to write a Shovel app.</p>
</article></body></html>